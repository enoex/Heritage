// Generated by CoffeeScript 1.4.0
(function() {

  define(['entity'], function(Entity) {
    var Living;
    Living = (function() {

      function Living(entities) {
        this.entities = entities;
        return this;
      }

      Living.prototype.updateHuman = function(entity) {
        var human, newZombie, physics;
        human = entity.components.human;
        physics = entity.components.physics;
        human.age += 0.1;
        physics.maxSpeed = human.getMaxSpeed();
        human.resources = human.calculateResources();
        human.health = human.calculateHealth();
        if (human.health < 0) {
          human.isDead = true;
        }
        if (human.isDead && human.hassZombieInfection) {
          newZombie = new Entity().addComponent('world').addComponent('position').addComponent('physics').addComponent('randomWalker').addComponent('renderer').addComponent('flocking').addComponent('zombie');
          newZombie.components.position = entity.components.position.copy();
          this.entities.add(newZombie);
        }
        if (human.isDead) {
          return this.entities.remove(entity);
        }
      };

      Living.prototype.tick = function(delta) {
        var entity, id, _ref, _results;
        _ref = this.entities.entitiesIndex['human'];
        _results = [];
        for (id in _ref) {
          entity = _ref[id];
          _results.push(this.updateHuman(entity));
        }
        return _results;
      };

      return Living;

    })();
    return Living;
  });

}).call(this);
