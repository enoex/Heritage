// Generated by CoffeeScript 1.4.0
(function() {

  define(['components/world'], function(WorldComponent) {
    var World;
    World = (function() {

      function World(entities) {
        this.entities = entities;
        WorldComponent.grid = {};
        return this;
      }

      World.prototype.getCellFromPosition = function(position) {
        var i, j;
        i = Math.floor(position.y / WorldComponent.cellSize);
        j = Math.floor(position.x / WorldComponent.cellSize);
        return [i, j];
      };

      World.prototype.tick = function(delta) {
        var cell, entity, i, id, j, position, world, _ref, _ref1;
        _ref = this.entities.entitiesIndex['world'];
        for (id in _ref) {
          entity = _ref[id];
          world = entity.components.world;
          position = entity.components.position;
          cell = this.getCellFromPosition(position);
          i = cell[0];
          j = cell[1];
          world.i = i;
          world.j = j;
          if (WorldComponent.grid[i] === void 0) {
            WorldComponent.grid[i] = {};
          }
          if (WorldComponent.grid[i][j] === void 0) {
            WorldComponent.grid[i][j] = [];
          }
          WorldComponent.grid[i][j].push(entity);
        }
        _ref1 = this.entities.entitiesIndex['world'];
        for (id in _ref1) {
          entity = _ref1[id];
          entity.components.world.getNeighbors();
        }
        return this;
      };

      return World;

    })();
    return World;
  });

}).call(this);
